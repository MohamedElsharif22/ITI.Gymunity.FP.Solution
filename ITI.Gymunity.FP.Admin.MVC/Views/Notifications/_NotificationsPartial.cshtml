@using ITI.Gymunity.FP.Admin.MVC.ViewModels.Notifications
@model IEnumerable<NotificationViewModel>

@{
    // Helper function to get CSS class for notification color
    string GetColorClass(string color) => color switch
    {
        "blue" => "bg-blue-50 border-blue-200",
        "purple" => "bg-purple-50 border-purple-200",
        "cyan" => "bg-cyan-50 border-cyan-200",
        "green" => "bg-green-50 border-green-200",
        "red" => "bg-red-50 border-red-200",
        "yellow" => "bg-yellow-50 border-yellow-200",
        "emerald" => "bg-emerald-50 border-emerald-200",
        "amber" => "bg-amber-50 border-amber-200",
        "indigo" => "bg-indigo-50 border-indigo-200",
        "teal" => "bg-teal-50 border-teal-200",
        "orange" => "bg-orange-50 border-orange-200",
        _ => "bg-gray-50 border-gray-200"
    };

    string GetIconClass(string color) => color switch
    {
        "blue" => "text-blue-600",
        "purple" => "text-purple-600",
        "cyan" => "text-cyan-600",
        "green" => "text-green-600",
        "red" => "text-red-600",
        "yellow" => "text-yellow-600",
        "emerald" => "text-emerald-600",
        "amber" => "text-amber-600",
        "indigo" => "text-indigo-600",
        "teal" => "text-teal-600",
        "orange" => "text-orange-600",
        _ => "text-gray-600"
    };

    string GetBgIconClass(string color) => color switch
    {
        "blue" => "bg-blue-100",
        "purple" => "bg-purple-100",
        "cyan" => "bg-cyan-100",
        "green" => "bg-green-100",
        "red" => "bg-red-100",
        "yellow" => "bg-yellow-100",
        "emerald" => "bg-emerald-100",
        "amber" => "bg-amber-100",
        "indigo" => "bg-indigo-100",
        "teal" => "bg-teal-100",
        "orange" => "bg-orange-100",
        _ => "bg-gray-100"
    };

    string GetBadgeClass(string color) => color switch
    {
        "blue" => "bg-blue-100 text-blue-700",
        "purple" => "bg-purple-100 text-purple-700",
        "cyan" => "bg-cyan-100 text-cyan-700",
        "green" => "bg-green-100 text-green-700",
        "red" => "bg-red-100 text-red-700",
        "yellow" => "bg-yellow-100 text-yellow-700",
        "emerald" => "bg-emerald-100 text-emerald-700",
        "amber" => "bg-amber-100 text-amber-700",
        "indigo" => "bg-indigo-100 text-indigo-700",
        "teal" => "bg-teal-100 text-teal-700",
        "orange" => "bg-orange-100 text-orange-700",
        _ => "bg-gray-100 text-gray-700"
    };

    string GetButtonHoverClass(string color) => color switch
    {
        "blue" => "text-blue-600 hover:text-blue-800 hover:bg-blue-100",
        "purple" => "text-purple-600 hover:text-purple-800 hover:bg-purple-100",
        "cyan" => "text-cyan-600 hover:text-cyan-800 hover:bg-cyan-100",
        "green" => "text-green-600 hover:text-green-800 hover:bg-green-100",
        "red" => "text-red-600 hover:text-red-800 hover:bg-red-100",
        "yellow" => "text-yellow-600 hover:text-yellow-800 hover:bg-yellow-100",
        "emerald" => "text-emerald-600 hover:text-emerald-800 hover:bg-emerald-100",
        "amber" => "text-amber-600 hover:text-amber-800 hover:bg-amber-100",
        "indigo" => "text-indigo-600 hover:text-indigo-800 hover:bg-indigo-100",
        "teal" => "text-teal-600 hover:text-teal-800 hover:bg-teal-100",
        "orange" => "text-orange-600 hover:text-orange-800 hover:bg-orange-100",
        _ => "text-gray-600 hover:text-gray-800 hover:bg-gray-100"
    };
}

@foreach (var notification in Model.OrderByDescending(n => n.CreatedAt))
{
    var colorClass = notification.NotificationColor;
    var bgClass = GetColorClass(colorClass);
    var iconClass = GetIconClass(colorClass);
    var bgIconClass = GetBgIconClass(colorClass);
    var badgeClass = GetBadgeClass(colorClass);
    var buttonHoverClass = GetButtonHoverClass(colorClass);
    var opacityClass = notification.IsRead ? "opacity-60" : "";
    var priorityBorderClass = notification.IsHighPriority ? "border-l-4 border-red-500" : "border-l-4 border-transparent";
    
    <div class="notification-item border-b border-gray-100 last:border-b-0 p-4 hover:bg-gray-50 transition @opacityClass @priorityBorderClass @bgClass cursor-pointer" 
         data-notification-id="@notification.Id"
         data-notification-type="@notification.Type"
         data-notification-category="@notification.NotificationCategory"
         data-is-read="@notification.IsRead.ToString().ToLower()">
        <div class="flex items-start justify-between gap-3">
            <div class="flex items-start gap-3 flex-1">
                <!-- Icon -->
                <div class="flex-shrink-0 w-10 h-10 rounded-lg @bgIconClass flex items-center justify-center mt-0.5">
                    <i class="@notification.NotificationIcon @iconClass"></i>
                </div>
                
                <!-- Content -->
                <div class="flex-1">
                    <div class="flex items-start justify-between gap-2">
                        <div>
                            <h6 class="font-semibold text-gray-900 text-sm">@notification.Title</h6>
                            @if (!string.IsNullOrEmpty(notification.NotificationCategory))
                            {
                                <span class="inline-block mt-1 text-xs font-medium @badgeClass px-2 py-0.5 rounded-full">
                                    @notification.NotificationCategory
                                </span>
                            }
                        </div>
                        @if (notification.IsHighPriority)
                        {
                            <span class="flex-shrink-0 text-red-600 ml-2" title="High Priority">
                                <i class="fas fa-exclamation-circle text-sm"></i>
                            </span>
                        }
                    </div>
                    <p class="text-gray-600 text-xs mt-2 line-clamp-2">@notification.Message</p>
                    <small class="text-gray-400 text-xs mt-2 block">
                        <i class="fas fa-clock mr-1"></i>@notification.FormattedTime
                    </small>
                </div>
            </div>
            
            <!-- Action -->
            <div class="flex-shrink-0">
                @if (!notification.IsRead)
                {
                    <button class="@buttonHoverClass p-1.5 rounded transition" 
                            onclick="markNotificationAsRead(@notification.Id)" 
                            title="Mark as read"
                            type="button">
                        <i class="fas fa-check text-sm"></i>
                    </button>
                }
                else
                {
                    <span class="text-xs text-gray-400 px-2 py-1">Read</span>
                }
            </div>
        </div>
    </div>
}
