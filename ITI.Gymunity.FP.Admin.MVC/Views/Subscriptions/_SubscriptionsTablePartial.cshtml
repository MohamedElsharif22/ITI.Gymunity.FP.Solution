@using ITI.Gymunity.FP.Domain.Models.Enums
@using ITI.Gymunity.FP.Application.DTOs.User.Subscribe
@model IEnumerable<SubscriptionResponse>

<!-- Subscriptions Table Partial View -->
<div class="overflow-x-auto">
    <table id="subscriptionsTable" class="w-full">
        <thead class="bg-gray-50 border-b border-gray-200">
            <tr>
                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">
                    <input type="checkbox" id="selectAll" class="rounded border-gray-300" />
                </th>
                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Subscription ID</th>
                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Package</th>
                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Trainer</th>
                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Amount</th>
                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Status</th>
                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-900">Duration</th>
                <th class="px-6 py-4 text-right text-sm font-semibold text-gray-900">Actions</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
            @if (Model.Any())
            {
                @foreach (var subscription in Model)
                {
                    <tr class="hover:bg-gray-50 transition subscription-row" data-subscription-id="@subscription.Id">
                        <td class="px-6 py-4">
                            <input type="checkbox" class="subscription-checkbox rounded border-gray-300" value="@subscription.Id" />
                        </td>
                        <td class="px-6 py-4 text-sm font-mono text-gray-900">
                            #@subscription.Id.ToString().PadLeft(6, '0')
                        </td>
                        <td class="px-6 py-4 text-sm font-medium text-gray-900">
                            @(subscription.PackageName ?? "N/A")
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-600">
                            @(subscription.TrainerName ?? "N/A")
                        </td>
                        <td class="px-6 py-4 text-sm font-semibold text-gray-900">
                            @(subscription.AmountPaid.ToString("C"))
                        </td>
                        <td class="px-6 py-4">
                            @{
                                var statusClass = subscription.Status switch
                                {
                                    SubscriptionStatus.Active => "bg-green-50 text-green-700",
                                    SubscriptionStatus.Canceled => "bg-red-50 text-red-700",
                                    SubscriptionStatus.Unpaid => "bg-yellow-50 text-yellow-700",
                                    _ => "bg-gray-50 text-gray-700"
                                };
                                
                                var statusIcon = subscription.Status switch
                                {
                                    SubscriptionStatus.Active => "fas fa-check-circle",
                                    SubscriptionStatus.Canceled => "fas fa-times-circle",
                                    SubscriptionStatus.Unpaid => "fas fa-exclamation-circle",
                                    _ => "fas fa-question-circle"
                                };
                            }
                            <span class="inline-flex items-center gap-2 px-3 py-1 @statusClass rounded-full text-sm font-medium">
                                <i class="@statusIcon"></i>
                                @subscription.Status.ToString()
                            </span>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-600">
                            <span title="@subscription.StartDate.ToString("MMM dd, yyyy") - @subscription.CurrentPeriodEnd.ToString("MMM dd, yyyy")">
                                @subscription.StartDate.ToString("MMM dd")
                                <span class="text-gray-400">â†’</span>
                                @subscription.CurrentPeriodEnd.ToString("MMM dd")
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex items-center justify-end gap-2">
                                <a href="@Url.Action("Details", new { id = subscription.Id })" 
                                   class="px-3 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-lg transition"
                                   title="View Details">
                                    <i class="fas fa-eye"></i>
                                </a>
                                
                                @if (subscription.Status == SubscriptionStatus.Active)
                                {
                                    <button type="button" 
                                            class="px-3 py-2 text-sm font-medium text-red-600 hover:bg-red-50 rounded-lg transition cancel-subscription-btn"
                                            data-subscription-id="@subscription.Id" 
                                            title="Cancel Subscription">
                                        <i class="fas fa-ban"></i>
                                    </button>
                                }
                            </div>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="8" class="px-6 py-12 text-center">
                        <div class="flex flex-col items-center justify-center gap-3">
                            <i class="fas fa-inbox text-4xl text-gray-300"></i>
                            <p class="text-gray-500 font-medium">No subscriptions found</p>
                            <p class="text-sm text-gray-400">Try adjusting your filters or search criteria</p>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
